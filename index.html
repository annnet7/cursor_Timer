<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Timer</title>

    <!--CDN link for TweenMax-->
    <script src='https://s0.2mdn.net/ads/studio/cached_libs/tweenmax_1.19.0_643d6911392a3398cb1607993edabfa7_min.js'></script>

</head>
<style>
    body {
        background-color: black;
        color: #fff;
    }
    
    div {
        margin-top: 20px;
    }
    
    .loadLine {
        height: 30px;
        background-color: #057863;
        width: 50%;
    }
</style>

<body>
    <form>
        <input type="number" name="minuts" id="inputMin" value="0" min="0" max="99">
        <label>:</label>
        <input type="number" name="seconds" id="inputSec" value="59" min="0" max="59">
        <input type="checkbox" name="autostart" id="inputAutoStart">
        <label>autostart</label>
        <input type="button" value="Generate" id="generateBtn">
    </form>
    <div id="container">

    </div>

    <script>
        //Положу джавуcкрипту внутри что бы меньше файликов тягать

        //////////////////////////////////////
        //////////////////////////////////////

        //таймер
        class myTimer {
            constructor() {
                    this.startMin = 0;
                    this.startSec = 0;
                    this.autoStart = false;
                }
                // сеттеры для того что бы можно было достучаться до параметров
            set setFullTime(timeStr) {
                let splitTime = timeStr.split(':');
                this.startMin = parseInt(splitTime[0]);
                let checkSec = parseInt(splitTime[1]);
                if (checkSec > 59 || checkSec < 0)
                    this.startSec = 59;
                else
                    this.startSec = checkSec;
            }
            set setAutoStart(_autoStart) {
                    this.autoStart = _autoStart;
                }
                //самый главный сеттер задаем все параметры разом
            set setAllParams(params) {
                    this.setFullTime = params[0];
                    this.setAutoStart = params[1];
                    this.setDiv = params[2];
                    params[2].innerText = params[0];
                    //т.к. дивка записывается после отработки сеттера то автостарт не отрабатывал не видел дивку, а  если ее передать параметром то все ок
                    if (params[1]) {
                        this.countDown(params[2]);
                    }
                }
                //удобная фигулина для отладки
            get showStatus() {
                return `${this.startMin}:${this.startSec}, Autostart:${this.autoStart}, contain in : ${this.divTimerContainer}`;
            }
            get getTimeInSec() {
                    return this.startMin * 60 + this.startSec;
                }
                //методы
                //начинаем отсчет            
            countDown(divContainer) {

                    let min = this.startMin;
                    let sec = this.startSec;
                    let obj = this; // потому что в интервале this = window
                    this.countInterval = setInterval(function() {
                        if (min > 0 || sec > 0) {
                            if (sec == 0) {
                                min--;
                                sec = 59;
                            } else sec--;
                            divContainer.innerText = (min < 10 ? ("0" + min) : min) + ":" + (sec < 10 ? ("0" + sec) : sec);
                            obj.startMin = min;
                            obj.startSec = sec;


                        } else clearInterval(this.countInterval);
                    }, 1000);


                    return;
                }
                //останавливаем отсчет
            stopCount() {
                clearInterval(this.countInterval);
            }
        }

        function btnControl(btnLink, timerLink, divLink, timeLine = false) {
            let startTimer = true;
            if (timerLink.autoStart) {
                startTimer = false;
                btnLink.innerText = "autostart, wona Stop!";
            }
            btnLink.addEventListener("click", function() {
                if (startTimer) {
                    timerLink.countDown(divLink);
                    btnLink.innerText = "Stop!";
                    startTimer = false;
                    if (timeLine != false) timeLine.continueAnimation();
                } else {
                    timerLink.stopCount();
                    btnLink.innerText = "Start :)";
                    startTimer = true;
                    if (timeLine != false) timeLine.pauseAnimation();
                }
            });
        }
        //линия загрузки 
        class LoadLineDiv {
            constructor(autoStart) {
                this.tl = new TimelineMax({
                    repeat: 0
                });
                if (!autoStart) this.tl.pause();
            }
            startAnimation(divLoader, timeInSec) {
                this.tl.to(divLoader, 70, {
                    width: 0
                }, 0.0);
            }
            continueAnimation() {
                this.tl.play();
            }
            pauseAnimation() {
                this.tl.pause();
            }
        }


        let genBtn = document.getElementById('generateBtn');
        genBtn.addEventListener("click", function() {

            console.log();
            //получим время и автостарт
            let timeFromInput = document.getElementById('inputMin').value + ":" + document.getElementById('inputSec').value;
            let autoFromInput = document.getElementById('inputAutoStart').checked;
            //
            let divTimer = document.createElement('div');
            divTimer.innerText = '00:00';
            let btnTimer = document.createElement('button');
            btnTimer.innerText = "Start :)";
            let divLoad = document.createElement('div');
            divLoad.className = "loadLine";

            let timeContainer = document.getElementById('container');
            timeContainer.appendChild(divTimer);
            timeContainer.appendChild(btnTimer);
            timeContainer.appendChild(divLoad);


            let objTimer = new myTimer();
            objTimer.setAllParams = [timeFromInput, autoFromInput, divTimer];

            let objLoad = new LoadLineDiv(autoFromInput);
            objLoad.startAnimation(divLoad, objTimer.getTimeInSec);

            btnControl(btnTimer, objTimer, divTimer, objLoad);
        });
    </script>

</body>

</html>